#summary Explains how to build the Page Speed native shared libraries using the Mozilla Build System
#labels tmp

= Prerequisites =

  # Install [http://subversion.tigris.org/ Subversion]. On Ubuntu, you can probably just run `sudo apt-get install subversion`.
  # Install [http://ant.apache.org Apache Ant]. On Ubuntu, you can probably just run `sudo apt-get install ant`.
  # Follow the Mozilla build instructions for your platform here: https://developer.mozilla.org/en/Build_Documentation#Getting_started (e.g. for Linux, run `sudo apt-get build-dep firefox`).

= How to build =

Preparing the Page Speed sources:

  # Download the Page Speed [http://code.google.com/p/page-speed/source/checkout source code].
  # Run `ant pkg-moz` from the trunk of the source tree. This will package the Page Speed sources for building in the Mozilla build system, in the file `dist/page-speed-moz.zip`.

Downloading and building in the Mozilla build system:

  # Download mozilla Firefox source: http://releases.mozilla.org/pub/mozilla.org/firefox/releases/latest/source/
  # Run `tar xjf firefox-*-source.tar.bz2` (you should probably do this somewhere outside of the Page Speed source tree, e.g. `/tmp`.
  # Unzip `page-speed-moz.zip` in the same directory that you untarred the mozilla source. This will overlay the Page Speed source in the mozilla extensions directory.
  # `cd mozilla`
  # `make -f client.mk build` This will build Firefox as well as Page Speed. It can take an hour or more.
  # The resulting shared object will be in `obj-firefox/extensions/pagespeed/src/pagespeed`

= Troubleshooting =

  * To build an [https://developer.mozilla.org/en/Mac_OS_X_Universal_Binaries OS X Universal binary], uncomment the first few lines in the [http://code.google.com/p/page-speed/source/browse/trunk/moz_resources/mozilla/.mozconfig .mozconfig] file.
  * To build without [https://developer.mozilla.org/en/atlbase.h atlbase.h] on Windows, uncomment the appropriate lines in the [http://code.google.com/p/page-speed/source/browse/trunk/moz_resources/mozilla/.mozconfig .mozconfig] file.